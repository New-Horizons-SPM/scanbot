# Commands
This page documents the available commands and how to use them when running Scanbot via Zulip or in a terminal.
For a list of available commands on the fly, run ```help```, or for help with a specific command, run ```help <command_name>```
<br>
## Scanbot Configuration
| Command           | Inputs           | Description                                                                                                                                                    | Example                      |
|-------------------|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
| help              | Command name     | Get help with a specific command                                                                                                                               | help survey                  |
| get_ip            |                  | Returns the configured IP address                                                                                                                              | get_ip                       |
| set_ip            | IP address       | Configures the IP of the machine running Nanonis                                                                                                               | set_ip 127.0.0.1             |
| get_portlist      |                  | Returns the list of ports being available to Scanbot                                                                                                           | get_portlist                 |
| set_portlist      | TCP ports        | List of ports delimited by a space                                                                                                                             | set_portlist 6501 6502       |
| get_upload_method |                  | Return the current upload method                                                                                                                               | get_upload_method            |
| set_upload_method | Upload method    | Can be one of ```path, zulip, firebase, no_upload```                                                                                                           | set_upload_method firebase   |
| get_path          |                  | Returns the current save path                                                                                                                                  | get_path                     |
| set_path          | path             | Configures the path to save PNGs                                                                                                                               | set_path ./scanbot_images/   |
| get_users         |                  | Return the list of users on the whitelist                                                                                                                      | get_users                    |
| add_user          | User email       | Zulip only: Add a user email to the whitelist. Only users on the whitelist can run Scanbot commands. Whitelist is stored in whitelist.txt on the host machine. | add_user example@example.com |
| stop              |                  | Stop Scanbot's current action                                                                                                                                  | stop                         |
| quit              |                  | Stop Scanbot running                                                                                                                                           | quit                         |

<br>

## Nanonis Configuration
| Command      | Inputs                                                                                                                                                                                                                                                                                                                                                                                                                                | Description                                                                              | Example            |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|--------------------|
| plot_channel | ```-c```: (int) Set default channel for scanbot to look at. -1 means no change. Run without options to see available channels. Default: ```-1```<br>```-a```: (int) Add channel to the scan buffer. -1 means no change. Run without options to see available channels. Default: ```-1```<br>```-r```: (int) Remove channel from the scan buffer. -1 means no change. Run without options to see available channels. Default: ```-1``` | Configure channels in the scan buffer.<br>Run without inputs to see a available channels | plot_channel -c=14 |

<br>

## Data Acquisition
| Command          | Inputs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Description                                                                                                                                                                        | Example                                                                                                                                            |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| plot             | ```-c```: (int) Channel to plot. -1 plots the default channel which can be set using plot_channel. Default: ```-1```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Return a PNG of the current scan frame                                                                                                                                             | plot                                                                                                                                               |
| survey           | ```-bias```: (float) Scan bias. Default: ```nanonis settings```<br>```-n```: (int) Size of the nxn grid of scans. Default: ```5```<br>```-i```: (int) Start the grid from this index. Default: ```1```<br>```-s```: (str) Suffix at the end of autosaved sxm files. Default: ```scanbot```<br>```-xy```: (float) Length and width of the scan frame (m). Default: ```nanonis settings```<br>```-dx```: (float) Scan grid spacing (m). Default is -xy. Default: ```nanonis settings```<br>```-px```: (int) Number of pixels. Default: ```nanonis settings```<br>```-st```: (float) Drift compensation time (s). Default: ```10```<br>```-stitch```: (int) Return the stitched survey after completion. 1: Yes, else No. Default: ```1```<br>```-hook```: (str) Name of a custom python script to call after each image..<br>```-autotip```: (int) Automatic tip shaping. 0=off, 1=on. Properties for the auto tip shaper should be set with auto_tip_shaper command. Default: ```0```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Conduct a survey where images in a grid of size nxn are taken                                                                                                                      | survey -n=3 -s=test_survey -bias=0.7                                                                                                               |
| survey2          | ```-bias```: (float) Scan bias. Default: ```nanonis settings```<br>```-n```: (int) Size of the nxn grid of scans within each survey. Default: ```5```<br>```-i```: (int) Start the grid from this index. Default: ```1```<br>```-s```: (str) Suffix at the end of autosaved sxm files. Default: ```scanbot```<br>```-xy```: (float) Length and width of the scan frame (m). Default: ```nanonis settings```<br>```-dx```: (float) Scan grid spacing (m). Default: ```nanonis settings```<br>```-px```: (int) Number of pixels. Default: ```nanonis settings```<br>```-st```: (float) Drift compensation time (s). Default: ```10```<br>```-stitch```: (int) Return the stitched survey after completion. 1: Yes, else No. Default: ```1```<br>```-hook```: (int) Flag to call a custom python script after each image. Script must be ~/scanbot/scanbot/hk_survey.py. 0=Don't call, 1=Call. Default: ```0```<br>```-autotip```: (int) Automatic tip shaping. 0=off, 1=on. Properties for the auto tip shaper should be set with auto_tip_shaper command. Default: ```0```<br>```-nx```: (int) Size of the nx x ny grid of surveys. This sets up nx x ny surveys each taken after moving -x/yStep motor steps. Default: ```2```<br>```-ny```: (int) Size of the nx x ny grid of surveys. This sets up nx x ny surveys each taken after moving -x/yStep motor steps. Default: ```2```<br>```-xStep```: (int) Number of motor steps between surveys in the X direction. Negative value snakes course grid in opposite direction. Default: ```20```<br>```-yStep```: (int) Number of motor steps between surveys in the Y+ direction. Negative value reverses to Y- direction. Default: ```20```<br>```-zStep```: (int) Number of motor steps to move in +Z (upwards) before moving the tip in x/y. Default: ```500```<br>```-xyV```: (float) Piezo voltage when moving motor steps in xy direction. Default: ```120```<br>```-zV```: (float) Piezo voltage when moving motor steps in z direction. Default: ```180```<br>```-xyF```: (float) Piezo frequency when moving motor steps in xy direction. Default: ```1100```<br>```-zF```: (float) Piezo frequency when moving motor steps in z direction. Default: ```1100``` | Conduct several surveys as above, moving the course motor between each one.<br>nx x ny surveys are acquired                                                                        | survey2 -bias=1 -n=4 -xy=50e-9 -dx=200e-9 -px=256 -nx=3 -ny=5 -zStep=2000 -yStep=-500                                                              |
| bias_dep         | ```-n```: (int) Number of images to take b/w initial and final bias. Default: ```5```<br>```-bdc```: (float) Bias of the drift correction images (V). Default: ```-1```<br>```-tdc```: (float) Time per line for drift correction images (s). Default: ```0.3```<br>```-tbdc```: (float) Backward direction speed multiplier for drift correct image. E.g. 1=same speed, 2=twice as fast, 0.5=half speed. Default: ```1```<br>```-pxdc```: (int) Number of pixels in drift correct images. 0=no drift correction. Default: ```128```<br>```-lxdc```: (int) Number of lines in drift correct image. 0=keep same ratio as px:lx. Default: ```0```<br>```-bi```: (float) Initial Bias (V). Default: ```-1```<br>```-bf```: (float) Final Bias (V). Default: ```1```<br>```-px```: (int) Number of pixels in images. Default: ```nanonis settings```<br>```-lx```: (int) Number of lines in images. 0=same as px. Default: ```0```<br>```-tlf```: (float) Time per line (forward direction) (s). Default: ```nanonis settings```<br>```-tb```: (float) Backward direction speed multiplier. E.g. 1=same speed, 2=twice as fast, 0.5=half speed. Default: ```1```<br>```-s```: (str) Suffix for the set of bias dep sxm files. Default: ```sb-biasdep```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Take a series of bias dependent images with drift correction (optional)                                                                                                            | bias_dep -n=4 -bi=2 -bf=0.5 -tlf=0.5 -tb=2 -px=256 -dcpx=128                                                                                       |
| zdep             | ```-zi```: (float) Initial tip lift from setpoint (m). Default: ```-10e-12```<br>```-zf```: (float) Final tip lift from setpoint (m). Default: ```10e-12```<br>```-nz```: (int) Number of scans between zi and zf. Default: ```5```<br>```-iset```: (float) Setpoint current (A). Limited to 1 nA. zi and zf are relative to this setpoint. Default: ```nanonis settings```<br>```-bset```: (float) Setpoint bias (V). Default: ```nanonis settings```<br>```-dciset```: (float) Setpoint current for drift correction (A). Default: ```nanonis settings```<br>```-bias```: (float) Scan bias during constant height (V). Default: ```nanonis settings```<br>```-dcbias```: (float) Scan bias during drift correction. 0 = dc off(V). Default: ```nanonis settings```<br>```-ft```: (float) Forward scan time per line during constant height (s). Default: ```nanonis settings```<br>```-bt```: (float) Backward scan time per line during constant height (s). Default: ```nanonis settings```<br>```-dct```: (float) Forward and backward time per line during drift correction (s). Default: ```nanonis settings```<br>```-px```: (int) Number of pixels for constant height image. Default: ```nanonis settings```<br>```-dcpx```: (int) Number of pixels for drift correction image. Default: ```nanonis settings```<br>```-lx```: (int) Number of lines for constant height image. 0=same as -px. Default: ```0```<br>```-dclx```: (int) Number of lines for drift correction image. 0=same as -dcpx. Default: ```0```<br>```-s```: (str) Suffix at the end of autosaved sxm files. Default: ```sb-zdep```<br>```-gif```: (int) Turn scans into a gif after completion. 0=No,1=Yes. Default: ```1```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | z-dependant constant height imaging. Useful for constant current imaging or nc-AFM force volumes                                                                                   | zdep -bias=2e-3 -iset=20e-12 -dcbias=20e-3 -dciset=20e-12 -zi=-120e-12 -zf=-100e-12 -nz=5 -ft=120 -bt=1 -dct=0.4 -px=256 -dcpx=256 -s=nc-AFM_z-dep |
| afm_registration | ```-zset```: (float) Initial tip lift from setpoint (m). Default: ```0```<br>```-iset```: (float) Setpoint current (A). Limited to 1 nA. zi and zf are relative to this setpoint. Default: ```nanonis settings```<br>```-bset```: (float) Bias at which the setpoint is measured (V). Default: ```nanonis settings```<br>```-bias```: (float) Scan bias during constant height (V). Default: ```nanonis settings```<br>```-ft```: (float) Forward scan time per line during constant height (s). Default: ```nanonis settings```<br>```-bt```: (float) Backward scan time per line during constant height (s). Default: ```nanonis settings```<br>```-px```: (int) Number of pixels for constant height image. Default: ```nanonis settings```<br>```-lx```: (int) Number of lines for constant height image. 0=same as -px. Default: ```0```<br>```-lz```: (int) Line number to perform tip lift -dz. lz is measured from the TOP of the scan frame, regardless of whether scan direction is up or down. i.e. lz=0 is at the top of the frame. Default: ```0```<br>```-dz```: (float) Tip lift (m) at line number -lz. Default: ```0```<br>```-dir```: (str) Scan dirction. Can be either 'up' or 'down'. Default: ```down```<br>```-s```: (str) Suffix at the end of autosaved sxm files. Default: ```sb-rego```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | nc_AFM registration. See for example [this image](https://www.researchgate.net/figure/Figure-S2-CO-tip-nc-AFM-imaging-registration-of-DCA3Cu2-on-Ag111-and-Cu111-a_fig4_351095585) |                                                                                                                                                    |


<br>

## STM Tip Actions
| Command         | Inputs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Description                                                                                                                                  | Example                   |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
| move_area       | ```-up```: (int) Steps to go up before moving across. min 10. Default: ```20```<br>```-upV```: (float) Controller amplitude during up motor steps. Default: ```270```<br>```-upF```: (float) Controller frequency during up motor steps. Default: ```2100```<br>```-dir```: (str) Direction to go across (either X+, X-, Y+, Y-). Default: ```Y+```<br>```-steps```: (int) Steps to move across after moving -up number of steps. Default: ```10```<br>```-dirV```: (float) Controller amplitude during across motor steps. Default: ```130```<br>```-dirF```: (float) Controller frequency during across motor steps. Default: ```2100```<br>```-zon```: (int) Turn the z-controller on after approaching. 1=on, 0=off. Default: ```1```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Move the tip to a new scan area. If a crash is detected during the move, the tip will be retracted until the current is below some threshold | move_area -dir=X+         |
| tip_shape_props | ```-sod```: (float) Switch off delay: the time (s) during which the Z position is averaged before switching the Z controller off. Default: ```nanonis settings```<br>```-cb```: (int) Change bias flag (0=Nanonis,1=Change Bias,2=Don't Change. Default: ```nanonis settings```<br>```-b1```: (float) The value applied to the Bias signal if cb is true. Default: ```nanonis settings```<br>```-z1```: (float) First tip lift (m) (i.e. -2e-9). Default: ```nanonis settings```<br>```-t1```: (float) Defines the time to ramp Z from current Z position to z1. Default: ```nanonis settings```<br>```-b2```: (float) Bias voltage applied just after the first Z ramping. Default: ```nanonis settings```<br>```-t2```: (float) Time to wait after applying the Bias Lift value b2. Default: ```nanonis settings```<br>```-z3```: (float) Height the tip is going to ramp for the second time (m) i.e. +5nm. Default: ```nanonis settings```<br>```-t3```: (float) Time to ramp Z in the second ramping [s].. Default: ```nanonis settings```<br>```-wait```: (float) Time to wait after restoring the initial Bias voltage. Default: ```nanonis settings```<br>```-fb```: (int) Restore the initial Z-Controller status. 0: off. 1: on. Default: ```nanonis settings``` | Configure the tip shaping properties in nanonis. Run with no options to return the current settings                                          | tip_shape_props -z1=-2e-9 |
| tip_shape       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Execute a tip shaping action. Settings can be configures with tip_shape_props command                                                        | tip_shape                 |
| set_crash_safety| ```-c```: (float) When moving the course piezos, a current above this value will be considered a crash and the tip will retract. -1 means no change. Default: ```-1```<br>```-V```: (float) Voltage applied to the 'Z' piezo during tip retraction after a crash is detected. -1 means no change. Default: ```-1```<br>```-F```: (float) Frequency applied to the 'Z' piezo during tip retraction after a crash is detected. -1 means no change. Default: ```-1```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Settings applied to the Z piezo during a tip retraction after detecting a crash                                                              | set_crash_safety -c=3e-9  |
| get_crash_safety|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Return the settings for crash safety                                                                                                         | get_crash_safety          |


<br>

## STM Automation
| Command                                 | Inputs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Description                                                                                               | Example                           |
|-----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|-----------------------------------|
| auto_tip_shape                          | ```-n```: (int) Max number of tip shapes to perform. -1 means keep going until criterea met. Default: ```10```<br>```-wh```: (float) Size of the square scan frame when imaging the clean surface. Default: ```10e-9```<br>```-sym```: (float) Minimum circularity requirement. 0=don't care, 1=perfectly circle. Default: ```0.7```<br>```-size```: (float) Max size of the desired tip imprint in units of nm2. Default: ```1.2```<br>```-zQA```: (float) z-lift when performing a light tip shape to asses quality of tip (m). Default: ```-0.9e-9```<br>```-ztip```: (float) z-lift when performing a tip shape to alter the tip (m). Default: ```-1.5e-9```<br>```-st```: (int) Drift compensation time (s). Default: ```10```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Routine that automatically prepares a nice tip. Assumes the substrate is a clean metal.                   | auto_tip_shape -sym=0.9 -size=2.1 |
| auto_init                               | ```-light```: (int) Flag to turn the light on/off before/after initialisation. This uses hk_light.turn_on() and hk_light.turn_off() functions. 0=Don't, 1=Do. Default: ```0```<br>```-cameraPort```: (int) cv2 camera port - usually 0 for desktops or 1 for laptops with an inbuilt camera.. Default: ```0```<br>```-demo```: (int) Load in an mp4 recording of the tip moving instead of using live feed. Default: ```0```<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Initialise tip, sample, and clean metal positions using the camera feed                                   | auto_init -cameraPort=0           |
| move_tip_to_sample<br>move_tip_to_clean | ```-light```: (int) Flag to turn the light on before moving and off after moving. This uses hk_light.turn_on() and hk_light.turn_off() functions. 0=Don't, 1=Do. Default: ```0```<br>```-cameraPort```: (int) cv2 camera port - usually 0 for desktops or 1 for laptops with an inbuilt camera. Default: ```0```<br>```-xStep```: (int) Number of motor steps in the X direction before updating tip position. More=Faster but might lose the tip. Default: ```100```<br>```-zStep```: (int) Number of motor steps to move in +Z (upwards) before updating tip position. More=Faster but might lose the tip. Default: ```250```<br>```-xV```: (float) Piezo voltage when moving motor steps in x direction. Default: ```130```<br>```-zV```: (float) Piezo voltage when moving motor steps in z direction. Default: ```180```<br>```-xF```: (float) Piezo frequency when moving motor steps in x direction. Default: ```1100```<br>```-zF```: (float) Piezo frequency when moving motor steps in z direction. Default: ```1100```<br>```-approach```: (int) Approach when tip reaches target. 0=No,1=Yes. Default: ```1```<br>```-demo```: (int) Load in an mp4 recording of the tip moving instead of using live feed. Default: ```0``` | After auto_init has been run, automatically move the tip to sample/clean metal locations using the camera | move_tip_to_sample -light=1       |